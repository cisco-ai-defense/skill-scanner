# Skill Scanner – PERMISSIVE Scan Policy
# ========================================
# Minimise false positives.  Broad allowlists, aggressive suppression.
# Use for: trusted / internal skills, high-FP-rate workflows, dev-time scanning.
#
# Usage:
#   skill-scanner scan --policy permissive ./my-skill

policy_name: permissive
policy_version: "1.0"

# ---------------------------------------------------------------------------
# Hidden files – very broad allowlist
# ---------------------------------------------------------------------------
hidden_files:
  benign_dotfiles:
    # Everything from default …
    - ".gitignore"
    - ".gitattributes"
    - ".gitmodules"
    - ".gitkeep"
    - ".editorconfig"
    - ".prettierrc"
    - ".prettierignore"
    - ".eslintrc"
    - ".eslintignore"
    - ".eslintrc.json"
    - ".eslintrc.js"
    - ".eslintrc.yml"
    - ".stylelintrc"
    - ".stylelintignore"
    - ".npmrc"
    - ".npmignore"
    - ".nvmrc"
    - ".node-version"
    - ".python-version"
    - ".ruby-version"
    - ".tool-versions"
    - ".flake8"
    - ".pylintrc"
    - ".isort.cfg"
    - ".mypy.ini"
    - ".babelrc"
    - ".browserslistrc"
    - ".postcssrc"
    - ".dockerignore"
    - ".env.example"
    - ".env.sample"
    - ".env.template"
    - ".markdownlint.json"
    - ".markdownlintignore"
    - ".yamllint"
    - ".yamllint.yml"
    - ".cursorrules"
    - ".cursorignore"
    - ".clang-format"
    - ".clang-tidy"
    - ".rubocop.yml"
    - ".solhint.json"
    - ".mcp.json"
    - ".envrc"
    - ".version"
    - ".goreleaser.yaml"
    - ".goreleaser.yml"
    # … plus extras for permissive
    - ".bazelrc"
    - ".bazelversion"
    - ".terraform.lock.hcl"
    - ".cargo-ok"
    - ".rustfmt.toml"
    - ".clippy.toml"
    - ".swift-version"
    - ".htaccess"
    - ".nojekyll"
    - ".yarnrc"
    - ".yarnrc.yml"
    - ".pnpmfile.cjs"
    - ".taprc"
    - ".nycrc"
    - ".c8rc.json"
    - ".swcrc"
    - ".parcelrc"
    - ".turbo"

  benign_dotdirs:
    - ".github"
    - ".vscode"
    - ".idea"
    - ".cursor"
    - ".husky"
    - ".circleci"
    - ".gitlab"
    - ".lance"
    - ".lmdb"
    - ".cache"
    - ".tmp"
    - ".data"
    - ".next"
    - ".nuxt"
    - ".parcel-cache"
    - ".claude"
    - ".claude-plugin"
    - ".codex"
    - ".osgrep"
    - ".obsidian"
    - ".leann"
    - ".devcontainer"
    - ".smithery"
    - ".vitepress"
    - ".docusaurus"
    - ".storybook"
    # Extras for permissive
    - ".yarn"
    - ".pnpm-store"
    - ".turbo"
    - ".nx"
    - ".angular"
    - ".serverless"
    - ".terraform"
    - ".cargo"
    - ".rustup"
    - ".gradle"
    - ".mvn"
    - ".bundle"
    - ".gem"
    - ".vagrant"

# ---------------------------------------------------------------------------
# Pipeline taint – broad installer trust + many benign patterns
# ---------------------------------------------------------------------------
pipeline:
  known_installer_domains:
    - "sh.rustup.rs"
    - "astral.sh"
    - "raw.githubusercontent.com/nvm-sh"
    - "get.sdkman.io"
    - "pyenv.run"
    - "get.docker.com"
    - "install.python-poetry.org"
    - "bun.sh"
    - "deno.land"
    - "get.volta.sh"
    - "brew.sh"
    - "getcomposer.org"
    - "nixos.org"
    - "get.pnpm.io"
    - "proto.moonrepo.app"
    - "mise.jdx.dev"
    - "taskfile.dev"
    # Additional trusted installer domains for permissive
    - "run.linkerd.io"
    - "run.api7.ai"
    - "starship.rs"
    - "raw.githubusercontent.com/ajeetdsouza"
    - "apify.com"
    - "get.helm.sh"
    - "istio.io"
    - "krew.sh"
    - "get.k3s.io"
    - "releases.hashicorp.com"

  benign_pipe_targets:
    - 'ps\s.*\|\s*grep'
    - 'grep\s.*\|\s*grep\s+-v'
    - 'cat\s.*\|\s*(sort|uniq|wc|head|tail|grep|cut|awk|sed)'
    - 'find\s.*\|\s*(sort|head|wc|xargs\s+ls)'
    - 'ls\s.*\|\s*(sort|head|grep|wc)'
    - 'echo\s.*\|\s*(tr|sed|awk|cut|base64)'
    - 'curl\s.*\|\s*(jq|python\s+-m\s+json\.tool|json_pp|yq|xmllint)'
    # Extras for permissive
    - 'docker\s.*\|\s*(grep|head|tail|jq)'
    - 'kubectl\s.*\|\s*(grep|jq|head)'
    - 'aws\s.*\|\s*(jq|grep|head)'
    - 'gh\s.*\|\s*(jq|grep)'
    - 'git\s.*\|\s*(grep|head|wc|sort)'

  doc_path_indicators:
    - "references"
    - "docs"
    - "examples"
    - "tutorials"
    - "guides"

# ---------------------------------------------------------------------------
# Rule scoping – narrower rule application
# ---------------------------------------------------------------------------
rule_scoping:
  skillmd_and_scripts_only:
    - "coercive_injection_generic"
    - "autonomy_abuse_generic"

  skip_in_docs:
    - "code_execution_generic"
    - "system_manipulation_generic"
    - "script_injection_generic"
    - "command_injection_generic"
    - "credential_harvesting_generic"

  code_only:
    - "prompt_injection_unicode_steganography"
    - "sql_injection_generic"

  doc_path_indicators:
    - "references"
    - "docs"
    - "examples"
    - "tutorials"
    - "guides"
    - "rules"
    - "indexes"
    - "demos"
    - "fixtures"
    - "test"
    - "tests"
    - "spec"
    - "patterns"
    - "samples"

  doc_filename_patterns:
    - 'security[_-]patterns|examples?|patterns?|samples?|demo|tutorial|guide|howto|cheatsheet|reference|spec'

# ---------------------------------------------------------------------------
# Credentials – broad suppression of well-known test values
# ---------------------------------------------------------------------------
credentials:
  known_test_values:
    # Stripe
    - "sk_test_4eC39HqLyjWDarjtT1zdp7dc"
    - "pk_test_TYooMQauvdEDq54NiTphI7jx"
    # JWT.io
    - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiaWF0IjoxNTE2MjM5MDIyfQ"
    # Placeholders
    - 'password="password"'
    - "password='password'"
    - "api_key='sk-no-key-required'"
    - 'api_key="sk-no-key-required"'
    # Additional for permissive
    - 'password="changeme"'
    - "password='changeme'"
    - 'password="example"'
    - "password='example'"
    - "AKIAIOSFODNN7EXAMPLE"
    - "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
    - '-----BEGIN RSA PRIVATE KEY----- ...'
    - "-----BEGIN PRIVATE KEY----- ..."
  placeholder_markers:
    - "your-"
    - "your_"
    - "your "
    - "example"
    - "sample"
    - "dummy"
    - "placeholder"
    - "replace"
    - "changeme"
    - "change_me"
    - "<your"
    - "<insert"

# ---------------------------------------------------------------------------
# System cleanup – permissive mode allows common generated artifacts
# ---------------------------------------------------------------------------
system_cleanup:
  safe_rm_targets:
    - "dist"
    - "build"
    - "tmp"
    - "temp"
    - ".tmp"
    - ".temp"
    - "bundle.html"
    - "bundle.js"
    - "bundle.css"
    - "node_modules"
    - ".next"
    - ".nuxt"
    - ".cache"
    - ".turbo"
    - ".pnpm-store"

# ---------------------------------------------------------------------------
# File classification – broader inert set
# ---------------------------------------------------------------------------
file_classification:
  inert_extensions:
    - ".ttf"
    - ".otf"
    - ".woff"
    - ".woff2"
    - ".eot"
    - ".png"
    - ".jpg"
    - ".jpeg"
    - ".gif"
    - ".webp"
    - ".ico"
    - ".bmp"
    - ".tiff"
    - ".pyc"
    - ".pyo"
    # Extras for permissive – treat more formats as inert
    - ".mp3"
    - ".mp4"
    - ".wav"
    - ".ogg"
    - ".flac"
    - ".avi"
    - ".mov"
    - ".mkv"
    - ".cur"
    - ".ani"

  structured_extensions:
    - ".svg"
    - ".pdf"
    - ".eps"
    - ".ai"

  archive_extensions:
    - ".zip"
    - ".tar.gz"
    - ".tgz"
    - ".tar"
    - ".gz"
    - ".bz2"
    - ".xz"
    - ".7z"
    - ".rar"
    - ".jar"
    - ".war"
    - ".apk"
    - ".docx"
    - ".xlsx"
    - ".pptx"
    - ".odt"
    - ".ods"
    - ".odp"
    # Extras for permissive
    - ".whl"
    - ".egg"
    - ".nupkg"
    - ".deb"
    - ".rpm"

  code_extensions:
    - ".py"
    - ".sh"
    - ".bash"
    - ".rb"
    - ".pl"
    - ".js"
    - ".ts"
    - ".php"
    - ".go"
    - ".rs"
    - ".java"
    - ".kt"
    - ".swift"
    - ".cs"
    - ".lua"
    - ".r"
    - ".jl"

# ---------------------------------------------------------------------------
# File limits – relaxed thresholds
# ---------------------------------------------------------------------------
file_limits:
  max_file_count: 500           # Large monorepo skills
  max_file_size_bytes: 20971520 # 20 MB
  max_reference_depth: 10       # Deep reference chains OK
  max_name_length: 128
  max_description_length: 4096
  min_description_length: 10    # Very short descriptions OK

# ---------------------------------------------------------------------------
# Analysis thresholds – less sensitive detection
# ---------------------------------------------------------------------------
analysis_thresholds:
  zerowidth_threshold_with_decode: 100  # Higher bar before flagging steg
  zerowidth_threshold_alone: 500        # Much higher for standalone zero-width
  analyzability_low_risk: 80            # Easier to reach LOW risk
  analyzability_medium_risk: 50         # Easier to reach MEDIUM risk

# ---------------------------------------------------------------------------
# Sensitive files – narrower patterns (fewer FPs)
# ---------------------------------------------------------------------------
sensitive_files:
  patterns:
    - '/etc/(?:passwd|shadow)'
    - '~?/\.(?:ssh|aws)'
    - '\.(?:pem|key|p12|pfx)'
    - '(?:credentials|secrets?)'

# ---------------------------------------------------------------------------
# Command safety – permissive: demote docker/kubectl/ssh to caution
# ---------------------------------------------------------------------------
command_safety:
  caution_commands:
    - "cp"
    - "mv"
    - "ln"
    - "mkdir"
    - "rmdir"
    - "touch"
    - "chmod"
    - "chown"
    - "chgrp"
    - "sed"
    - "awk"
    - "gawk"
    - "perl"
    - "make"
    - "cmake"
    - "gradle"
    - "mvn"
    - "dotnet"
    - "rustc"
    - "apt"
    - "apt-get"
    - "brew"
    - "yum"
    - "dnf"
    - "pacman"
    - "apk"
    # Demoted from risky in permissive mode
    - "docker"
    - "podman"
    - "kubectl"
    - "ssh"
    - "scp"
    - "rsync"

# ---------------------------------------------------------------------------
# Analyzers – all enabled
# ---------------------------------------------------------------------------
analyzers:
  static: true
  bytecode: true
  pipeline: true

# ---------------------------------------------------------------------------
# Severity overrides – demote noisy rules
# ---------------------------------------------------------------------------
severity_overrides:
  - rule_id: ARCHIVE_FILE_DETECTED
    severity: LOW
    reason: "Archives are common in permissive mode"
  - rule_id: TOOL_ABUSE_SYSTEM_PACKAGE_INSTALL
    severity: LOW
    reason: "System package installs are expected"

# ---------------------------------------------------------------------------
# Disabled rules – suppress noisy rules entirely
# ---------------------------------------------------------------------------
disabled_rules:
  - LAZY_LOAD_DEEP_NESTING
  - MANIFEST_INVALID_NAME
  # Explicitly disabled; keep out of rule_scoping to avoid conflicting intent.
  - capability_inflation_generic
  - indirect_prompt_injection_generic
